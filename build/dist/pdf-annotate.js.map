{"version":3,"sources":["webpack://PDFAnnotate/webpack/universalModuleDefinition","webpack://PDFAnnotate/webpack/bootstrap","webpack://PDFAnnotate/./src/PDFJSAnnotate.js","webpack://PDFAnnotate/./src/UI/utils.js","webpack://PDFAnnotate/./src/render/appendChild.js","webpack://PDFAnnotate/./src/utils/setAttributes.js","webpack://PDFAnnotate/./src/UI/event.js","webpack://PDFAnnotate/./src/utils/normalizeColor.js","webpack://PDFAnnotate/./src/a11y/renderScreenReaderHints.js","webpack://PDFAnnotate/./src/adapter/StoreAdapter.js","webpack://PDFAnnotate/./src/a11y/insertScreenReaderHint.js","webpack://PDFAnnotate/./src/a11y/insertElementWithinElement.js","webpack://PDFAnnotate/./src/a11y/renderScreenReaderComments.js","webpack://PDFAnnotate/./src/a11y/insertScreenReaderComment.js","webpack://PDFAnnotate/./index.js","webpack://PDFAnnotate/./src/utils/abstractFunction.js","webpack://PDFAnnotate/./node_modules/events/events.js","webpack://PDFAnnotate/./node_modules/create-stylesheet/index.js","webpack://PDFAnnotate/./src/adapter/LocalStoreAdapter.js","webpack://PDFAnnotate/./src/utils/uuid.js","webpack://PDFAnnotate/./src/render/index.js","webpack://PDFAnnotate/./node_modules/object-assign/index.js","webpack://PDFAnnotate/./src/render/renderLine.js","webpack://PDFAnnotate/./src/render/renderPath.js","webpack://PDFAnnotate/./src/render/renderPoint.js","webpack://PDFAnnotate/./src/render/renderRect.js","webpack://PDFAnnotate/./src/render/renderText.js","webpack://PDFAnnotate/./src/a11y/createScreenReaderOnly.js","webpack://PDFAnnotate/./src/a11y/insertElementWithinChildren.js","webpack://PDFAnnotate/./src/a11y/initEventHandlers.js","webpack://PDFAnnotate/./src/UI/index.js","webpack://PDFAnnotate/./src/UI/edit.js","webpack://PDFAnnotate/./src/UI/pen.js","webpack://PDFAnnotate/./src/UI/point.js","webpack://PDFAnnotate/./src/UI/rect.js","webpack://PDFAnnotate/./src/UI/text.js","webpack://PDFAnnotate/./src/UI/page.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","StoreAdapter","LocalStoreAdapter","__storeAdapter","getStoreAdapter","this","setStoreAdapter","adapter","UI","render","getAnnotations","documentId","pageNumber","_getStoreAdapter","apply","arguments","findSVGContainer","node","parentNode","document","nodeName","toUpperCase","getAttribute","findSVGAtPoint","findAnnotationAtPoint","x","y","svg","elements","querySelectorAll","length","el","pointIntersectsRect","getOffsetAnnotationRect","getAnnotationRect","scaleUp","scaleDown","rect","result","viewport","getMetadata","keys","forEach","scale","getScroll","scrollTop","scrollLeft","getOffset","disableUserSelect","userSelectStyleSheet","head","appendChild","enableUserSelect","removeChild","BORDER_COLOR","_createStylesheet2","default","body","-webkit-user-select","-moz-user-select","-ms-user-select","user-select","getBoundingClientRect","top","bottom","left","right","_getOffset","offsetLeft","offsetTop","h","w","toLowerCase","minX","maxX","minY","maxY","replace","split","splice","map","parseInt","LINE_OFFSET","height","width","_getOffset2","includes","JSON","parse","setAttribute","annotation","child","type","_renderRect2","_renderLine2","_renderPoint2","_renderText2","_renderPath2","uuid","transform","trans","rotation","getTranslation","isFirefox","path","querySelector","_objectAssign2","test","navigator","userAgent","attributes","keyCase","UPPER_REGEX","BLACKLIST","indexOf","match","fireEvent","emitter","emit","addEventListener","on","removeEventListener","removeListener","_utils","EventEmitter","clickNode","e","clientX","clientY","target","color","REGEX_HASHLESS_HEX","annotations","Array","isArray","SORT_TYPES","sortBy","filter","a","sort","_insertScreenReaderHint2","sortByPoint","b","sortByRectPoint","rectangles","highlight","strikeout","drawing","lineA","lines","lineB","textbox","point","area","_event","_this","definition","undefined","_classCallCheck","_abstractFunction2","annotationId","content","commentId","__getAnnotations","fn","then","__addAnnotation","__editAnnotation","__deleteAnnotation","success","__addComment","comment","__deleteComment","num","rects","first","last","_insertElementWithinElement2","_createScreenReaderOnly2","page","text","_insertElementWithinChildren2","COMMENT_TYPES","_renderScreenReaderComments2","insertBefore","concat","_toConsumableArray","textLayerElementFromPoint","Math","max","temp","cloneNode","innerHTML","tail","style","position","unshift","pop","join","outerHTML","comments","promise","Promise","resolve","PDFJSAnnotate","getComments","getElementById","list","createElement","insertScreenReaderComment","item","createTextNode","Error","_events","_maxListeners","isFunction","arg","isObject","isUndefined","defaultMaxListeners","setMaxListeners","isNumber","isNaN","TypeError","er","handler","len","args","listeners","error","err","context","slice","addListener","listener","newListener","push","warned","console","trace","once","fired","g","removeAllListeners","listenerCount","evlistener","blocks","selector","block","prop","hyphenate","processDeclaration","processDeclarationBlock","processRuleSet","_possibleConstructorReturn","__proto__","getPrototypeOf","reject","class","getAnnotation","findAnnotation","addAnnotation","_uuid2","updateAnnotations","editAnnotation","deleteAnnotation","index","addComment","deleteComment","localStorage","getItem","setItem","stringify","PATTERN","REGEXP","replacement","random","toString","data","removeAttribute","_appendChild2","getOwnPropertySymbols","propIsEnumerable","propertyIsEnumerable","assign","test1","String","getOwnPropertyNames","test2","fromCharCode","test3","letter","shouldUseNative","source","from","symbols","to","val","toObject","group","createElementNS","_setAttributes2","stroke","_normalizeColor2","strokeWidth","line","x1","y1","x2","y2","p1","p2","fill","outerSVG","innerSVG","SIZE","viewBox","D","fillOpacity","createRect","size","fontSize","overflow","nodes","textLayer","textRect","reorderAnnotationsByType","removeAnnotation","insertComment","removeComment","renderScreenReaderHints","removeElementById","_insertScreenReaderComment2","elementId","_edit","_pen","_point","_rect","_text","_page","disableEdit","enableEdit","disablePen","enablePen","setPen","disablePoint","enablePoint","disableRect","enableRect","disableText","enableText","setText","createPage","renderPage","_enabled","handleAnnotationClick","destroyEditOverlay","isDragging","overlay","dragOffsetX","dragOffsetY","dragStartX","dragStartY","OVERLAY_BORDER_SIZE","handleDocumentClick","handleDocumentKeyup","handleDocumentMousedown","handleDocumentMousemove","handleDocumentMouseup","keyCode","background","cursor","display","offsetHeight","offsetWidth","calcDelta","deltaX","deltaY","_getDelta","propX","propY","getDelta","modelY","viewY","modelX","viewX","_annotation$lines$","_slicedToArray","originX","originY","_calcDelta","_annotation$lines$i","setTimeout","anchor","id","styleLeft","styleTop","boxSizing","border","borderRadius","padding","textAlign","textDecoration","borderColor","boxShadow","createEditOverlay","penSize","penColor","_penSize","_penColor","_getMetadata","savePoint","input","handleInputBlur","handleInputKeyup","focus","closeInput","trim","_type","getSelection","getRangeAt","getClientRects","getSelectionRects","saveRect","removeAllRanges","boundingRect","offset","textSize","textColor","_textSize","_textColor","saveText","log","PAGE_TEMPLATE","children","canvas","mozOpaque","renderOptions","pdfDocument","rotate","all","getPage","_ref","_ref2","pdfPage","canvasContext","getContext","alpha","getViewport","wrapper","outputScale","ctx","devicePixelRatio","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","pixelRatio","sx","sy","scaled","getOutputScale","sfx","approximateFraction","sfy","visibility","roundToDivide","scalePage","getTextContent","normalizeWhitespace","textContent","textLayerFactory","PDFJS","DefaultTextLayerFactory","textLayerBuilder","createTextLayerBuilder","setTextContent","_renderScreenReaderHints2","floor","xinv","x_","q","div","round"],"mappings":"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","file":"dist/pdf-annotate.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PDFAnnotate\"] = factory();\n\telse\n\t\troot[\"PDFAnnotate\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","import StoreAdapter from './adapter/StoreAdapter';\r\nimport LocalStoreAdapter from './adapter/LocalStoreAdapter';\r\nimport render from './render';\r\nimport UI from './UI';\r\n\r\nexport default {\r\n  /**\r\n   * Abstract class that needs to be defined so PDFJSAnnotate\r\n   * knows how to communicate with your server.\r\n   */\r\n  StoreAdapter,\r\n\r\n  /**\r\n   * Implementation of StoreAdapter that stores annotation data to localStorage.\r\n   */\r\n  LocalStoreAdapter,\r\n\r\n  /**\r\n   * Abstract instance of StoreAdapter\r\n   */\r\n  __storeAdapter: new StoreAdapter(),\r\n\r\n  /**\r\n   * Getter for the underlying StoreAdapter property\r\n   *\r\n   * @return {StoreAdapter}\r\n   */\r\n  getStoreAdapter() {\r\n    return this.__storeAdapter;\r\n  },\r\n\r\n  /**\r\n   * Setter for the underlying StoreAdapter property\r\n   *\r\n   * @param {StoreAdapter} adapter The StoreAdapter implementation to be used.\r\n   */\r\n  setStoreAdapter(adapter) {\r\n    // TODO this throws an error when bundled\r\n    // if (!(adapter instanceof StoreAdapter)) {\r\n    //   throw new Error('adapter must be an instance of StoreAdapter');\r\n    // }\r\n\r\n    this.__storeAdapter = adapter;\r\n  },\r\n\r\n  /**\r\n   * UI is a helper for instrumenting UI interactions for creating,\r\n   * editing, and deleting annotations in the browser.\r\n   */\r\n  UI,\r\n\r\n  /**\r\n   * Render the annotations for a page in the PDF Document\r\n   *\r\n   * @param {SVGElement} svg The SVG element that annotations should be rendered to\r\n   * @param {PageViewport} viewport The PDFPage.getViewport data\r\n   * @param {Object} data The StoreAdapter.getAnnotations data\r\n   * @return {Promise}\r\n   */\r\n  render,\r\n\r\n  /**\r\n   * Convenience method for getting annotation data\r\n   *\r\n   * @alias StoreAdapter.getAnnotations\r\n   * @param {String} documentId The ID of the document\r\n   * @param {String} pageNumber The page number\r\n   * @return {Promise}\r\n   */\r\n  getAnnotations(documentId, pageNumber) {\r\n    return this.getStoreAdapter().getAnnotations(...arguments);\r\n  }\r\n}\r\n","import createStyleSheet from 'create-stylesheet';\r\n\r\nexport const BORDER_COLOR = '#00BFFF';\r\n\r\nconst userSelectStyleSheet = createStyleSheet({\r\n  body: {\r\n    '-webkit-user-select': 'none',\r\n       '-moz-user-select': 'none',\r\n        '-ms-user-select': 'none',\r\n            'user-select': 'none'\r\n  }\r\n});\r\nuserSelectStyleSheet.setAttribute('data-pdf-annotate-user-select', 'true');\r\n\r\n/**\r\n * Find the SVGElement that contains all the annotations for a page\r\n *\r\n * @param {Element} node An annotation within that container\r\n * @return {SVGElement} The container SVG or null if it can't be found\r\n */\r\nexport function findSVGContainer(node) {\r\n  let parentNode = node;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    if (parentNode.nodeName.toUpperCase() === 'SVG' &&\r\n        parentNode.getAttribute('data-pdf-annotate-container') === 'true') {\r\n      return parentNode;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Find an SVGElement container at a given point\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @return {SVGElement} The container SVG or null if one can't be found\r\n */\r\nexport function findSVGAtPoint(x, y) {\r\n  let elements = document.querySelectorAll('svg[data-pdf-annotate-container=\"true\"]');\r\n\r\n  for (let i=0, l=elements.length; i<l; i++) {\r\n    let el = elements[i];\r\n    let rect = el.getBoundingClientRect();\r\n\r\n    if (pointIntersectsRect(x, y, rect)) {\r\n\r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Find an Element that represents an annotation at a given point\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @return {Element} The annotation element or null if one can't be found\r\n */\r\nexport function findAnnotationAtPoint(x, y) {\r\n  let svg = findSVGAtPoint(x, y);\r\n  if (!svg) { return; }\r\n  let elements = svg.querySelectorAll('[data-pdf-annotate-type]');\r\n\r\n  // Find a target element within SVG\r\n  for (let i=0, l=elements.length; i<l; i++) {\r\n    let el = elements[i];\r\n    if (pointIntersectsRect(x, y, getOffsetAnnotationRect(el))) {   \r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Determine if a point intersects a rect\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Object} rect The points of a rect (likely from getBoundingClientRect)\r\n * @return {Boolean} True if a collision occurs, otherwise false\r\n */\r\nexport function pointIntersectsRect(x, y, rect) {\r\n  return y >= rect.top && y <= rect.bottom && x >= rect.left && x <= rect.right;\r\n}\r\n\r\n/**\r\n * Get the rect of an annotation element accounting for offset.\r\n *\r\n * @param {Element} el The element to get the rect of\r\n * @return {Object} The dimensions of the element\r\n */\r\nexport function getOffsetAnnotationRect(el) {\r\n  let rect = getAnnotationRect(el);\r\n  let { offsetLeft, offsetTop } = getOffset(el);\r\n  return {\r\n    top: rect.top + offsetTop,\r\n    left: rect.left + offsetLeft,\r\n    right: rect.right + offsetLeft,\r\n    bottom: rect.bottom + offsetTop\r\n  };\r\n}\r\n\r\n/**\r\n * Get the rect of an annotation element.\r\n *\r\n * @param {Element} el The element to get the rect of\r\n * @return {Object} The dimensions of the element\r\n */\r\nexport function getAnnotationRect(el) {\r\n  let h = 0, w = 0, x = 0, y = 0;\r\n  let rect = el.getBoundingClientRect();\r\n  // TODO this should be calculated somehow\r\n  const LINE_OFFSET = 16;\r\n\r\n  switch (el.nodeName.toLowerCase()) {\r\n    case 'path':\r\n    let minX, maxX, minY, maxY;\r\n\r\n    el.getAttribute('d').replace(/Z/, '').split('M').splice(1).forEach((p) => {\r\n      var s = p.split(' ').map(i => parseInt(i, 10));\r\n\r\n      if (typeof minX === 'undefined' || s[0] < minX) { minX = s[0]; }\r\n      if (typeof maxX === 'undefined' || s[2] > maxX) { maxX = s[2]; }\r\n      if (typeof minY === 'undefined' || s[1] < minY) { minY = s[1]; }\r\n      if (typeof maxY === 'undefined' || s[3] > maxY) { maxY = s[3]; }\r\n    });\r\n\r\n    h = maxY - minY;\r\n    w = maxX - minX;\r\n    x = minX;\r\n    y = minY;\r\n    break;\r\n\r\n    case 'line':\r\n    h = parseInt(el.getAttribute('y2'), 10) - parseInt(el.getAttribute('y1'), 10);\r\n    w = parseInt(el.getAttribute('x2'), 10) - parseInt(el.getAttribute('x1'), 10);\r\n    x = parseInt(el.getAttribute('x1'), 10);\r\n    y = parseInt(el.getAttribute('y1'), 10);\r\n\r\n    if (h === 0) {\r\n      h += LINE_OFFSET;\r\n      y -= (LINE_OFFSET / 2);\r\n    }\r\n    break;\r\n\r\n    case 'text':\r\n    h = rect.height;\r\n    w = rect.width;\r\n    x = parseInt(el.getAttribute('x'), 10);\r\n    y = parseInt(el.getAttribute('y'), 10) - h;\r\n    break;\r\n\r\n    case 'g':\r\n    let { offsetLeft, offsetTop } = getOffset(el);\r\n    h = rect.height;\r\n    w = rect.width;\r\n    x = rect.left - offsetLeft;\r\n    y = rect.top - offsetTop;\r\n\r\n    if (el.getAttribute('data-pdf-annotate-type') === 'strikeout') {\r\n      h += LINE_OFFSET;\r\n      y -= (LINE_OFFSET / 2);\r\n    }\r\n    break;\r\n\r\n    case 'rect':\r\n    case 'svg':\r\n    h = parseInt(el.getAttribute('height'), 10);\r\n    w = parseInt(el.getAttribute('width'), 10);\r\n    x = parseInt(el.getAttribute('x'), 10);\r\n    y = parseInt(el.getAttribute('y'), 10);\r\n    break;\r\n  }\r\n\r\n  // Result provides same properties as getBoundingClientRect\r\n  let result = {\r\n    top: y,\r\n    left: x,\r\n    width: w,\r\n    height: h,\r\n    right: x + w,\r\n    bottom: y + h\r\n  };\r\n\r\n  // For the case of nested SVG (point annotations) and grouped\r\n  // lines or rects no adjustment needs to be made for scale.\r\n  // I assume that the scale is already being handled\r\n  // natively by virtue of the `transform` attribute.\r\n  if (!['svg', 'g'].includes(el.nodeName.toLowerCase())) {\r\n    result = scaleUp(findSVGAtPoint(rect.left, rect.top), result);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Adjust scale from normalized scale (100%) to rendered scale.\r\n *\r\n * @param {SVGElement} svg The SVG to gather metadata from\r\n * @param {Object} rect A map of numeric values to scale\r\n * @return {Object} A copy of `rect` with values scaled up\r\n */\r\nexport function scaleUp(svg, rect) {\r\n  let result = {};\r\n  let { viewport } = getMetadata(svg);\r\n\r\n  Object.keys(rect).forEach((key) => {\r\n    result[key] = rect[key] * viewport.scale;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Adjust scale from rendered scale to a normalized scale (100%).\r\n *\r\n * @param {SVGElement} svg The SVG to gather metadata from\r\n * @param {Object} rect A map of numeric values to scale\r\n * @return {Object} A copy of `rect` with values scaled down\r\n */\r\nexport function scaleDown(svg, rect) {\r\n  let result = {};\r\n  let { viewport } = getMetadata(svg);\r\n\r\n  Object.keys(rect).forEach((key) => {\r\n    result[key] = rect[key] / viewport.scale;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Get the scroll position of an element, accounting for parent elements\r\n *\r\n * @param {Element} el The element to get the scroll position for\r\n * @return {Object} The scrollTop and scrollLeft position\r\n */\r\nexport function getScroll(el) {\r\n  let scrollTop = 0;\r\n  let scrollLeft = 0;\r\n  let parentNode = el;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    scrollTop += parentNode.scrollTop;\r\n    scrollLeft += parentNode.scrollLeft;\r\n  }\r\n\r\n  return { scrollTop, scrollLeft };\r\n}\r\n\r\n/**\r\n * Get the offset position of an element, accounting for parent elements\r\n *\r\n * @param {Element} el The element to get the offset position for\r\n * @return {Object} The offsetTop and offsetLeft position\r\n */\r\nexport function getOffset(el) {\r\n  let parentNode = el;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    if (parentNode.nodeName.toUpperCase() === 'SVG') {\r\n      break;\r\n    }\r\n  }\r\n\r\n  let rect = parentNode.getBoundingClientRect();\r\n\r\n  return { offsetLeft: rect.left, offsetTop: rect.top };\r\n}\r\n\r\n/**\r\n * Disable user ability to select text on page\r\n */\r\nexport function disableUserSelect() {\r\n  if (!userSelectStyleSheet.parentNode) {\r\n    document.head.appendChild(userSelectStyleSheet);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Enable user ability to select text on page\r\n */\r\nexport function enableUserSelect() {\r\n  if (userSelectStyleSheet.parentNode) {\r\n    userSelectStyleSheet.parentNode.removeChild(userSelectStyleSheet);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the metadata for a SVG container\r\n *\r\n * @param {SVGElement} svg The SVG container to get metadata for\r\n */\r\nexport function getMetadata(svg) {\r\n  return {\r\n    documentId: svg.getAttribute('data-pdf-annotate-document'),\r\n    pageNumber: parseInt(svg.getAttribute('data-pdf-annotate-page'), 10),\r\n    viewport: JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'))\r\n  };\r\n}\r\n","import objectAssign from 'object-assign';\r\nimport renderLine from './renderLine';\r\nimport renderPath from './renderPath';\r\nimport renderPoint from './renderPoint';\r\nimport renderRect from './renderRect';\r\nimport renderText from './renderText';\r\n\r\nconst isFirefox = /firefox/i.test(navigator.userAgent);\r\n\r\n/**\r\n * Get the x/y translation to be used for transforming the annotations\r\n * based on the rotation of the viewport.\r\n *\r\n * @param {Object} viewport The viewport data from the page\r\n * @return {Object}\r\n */\r\nfunction getTranslation(viewport) {\r\n  let x;\r\n  let y;\r\n\r\n  // Modulus 360 on the rotation so that we only\r\n  // have to worry about four possible values.\r\n  switch(viewport.rotation % 360) {\r\n    case 0:\r\n      x = y = 0;\r\n      break;\r\n    case 90:\r\n      x = 0;\r\n      y = (viewport.width / viewport.scale) * -1;\r\n      break;\r\n    case 180:\r\n      x = (viewport.width / viewport.scale) * -1;\r\n      y = (viewport.height / viewport.scale) * -1;\r\n      break;\r\n    case 270:\r\n      x = (viewport.height / viewport.scale) * -1;\r\n      y = 0;\r\n      break;\r\n  }\r\n\r\n  return { x, y };\r\n}\r\n\r\n/**\r\n * Transform the rotation and scale of a node using SVG's native transform attribute.\r\n *\r\n * @param {Node} node The node to be transformed\r\n * @param {Object} viewport The page's viewport data\r\n * @return {Node}\r\n */\r\nfunction transform(node, viewport) {\r\n  let trans = getTranslation(viewport);\r\n\r\n  // Let SVG natively transform the element\r\n  node.setAttribute('transform', `scale(${viewport.scale}) rotate(${viewport.rotation}) translate(${trans.x}, ${trans.y})`);\r\n  \r\n  // Manually adjust x/y for nested SVG nodes\r\n  if (!isFirefox && node.nodeName.toLowerCase() === 'svg') {\r\n    node.setAttribute('x', parseInt(node.getAttribute('x'), 10) * viewport.scale);\r\n    node.setAttribute('y', parseInt(node.getAttribute('y'), 10) * viewport.scale);\r\n\r\n    let x = parseInt(node.getAttribute('x', 10));\r\n    let y = parseInt(node.getAttribute('y', 10));\r\n    let width = parseInt(node.getAttribute('width'), 10);\r\n    let height = parseInt(node.getAttribute('height'), 10);\r\n    let path = node.querySelector('path');\r\n    let svg = path.parentNode;\r\n   \r\n    // Scale width/height\r\n    [node, svg, path, node.querySelector('rect')].forEach((n) => {\r\n      n.setAttribute('width', parseInt(n.getAttribute('width'), 10) * viewport.scale);\r\n      n.setAttribute('height', parseInt(n.getAttribute('height'), 10) * viewport.scale);\r\n    });\r\n\r\n    // Transform path but keep scale at 100% since it will be handled natively\r\n    transform(path, objectAssign({}, viewport, { scale: 1 }));\r\n    \r\n    switch(viewport.rotation % 360) {\r\n      case 90:\r\n        node.setAttribute('x', viewport.width - y - width);\r\n        node.setAttribute('y', x);\r\n        svg.setAttribute('x', 1);\r\n        svg.setAttribute('y', 0);\r\n        break;\r\n      case 180:\r\n        node.setAttribute('x', viewport.width - x - width);\r\n        node.setAttribute('y', viewport.height - y - height);\r\n        svg.setAttribute('y', 2);\r\n        break;\r\n      case 270:\r\n        node.setAttribute('x', y);\r\n        node.setAttribute('y', viewport.height - x - height);\r\n        svg.setAttribute('x', -1);\r\n        svg.setAttribute('y', 0);\r\n        break;\r\n    }\r\n  }\r\n\r\n  return node;\r\n}\r\n\r\n/**\r\n * Append an annotation as a child of an SVG.\r\n *\r\n * @param {SVGElement} svg The SVG element to append the annotation to\r\n * @param {Object} annotation The annotation definition to render and append\r\n * @param {Object} viewport The page's viewport data\r\n * @return {SVGElement} A node that was created and appended by this function\r\n */\r\nexport default function appendChild(svg, annotation, viewport) {\r\n  if (!viewport) {\r\n    viewport = JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'));\r\n  }\r\n  \r\n  let child;\r\n  switch (annotation.type) {\r\n    case 'area':\r\n    case 'highlight':\r\n      child = renderRect(annotation);\r\n      break;\r\n    case 'strikeout':\r\n      child = renderLine(annotation);\r\n      break;\r\n    case 'point':\r\n      child = renderPoint(annotation);\r\n      break;\r\n    case 'textbox':\r\n      child = renderText(annotation);\r\n      break;\r\n    case 'drawing':\r\n      child = renderPath(annotation);\r\n      break;\r\n  }\r\n\r\n  // If no type was provided for an annotation it will result in node being null.\r\n  // Skip appending/transforming if node doesn't exist.\r\n  if (child) {\r\n    // Set attributes\r\n    child.setAttribute('data-pdf-annotate-id', annotation.uuid);\r\n    child.setAttribute('data-pdf-annotate-type', annotation.type);\r\n    child.setAttribute('aria-hidden', true);\r\n\r\n    svg.appendChild(transform(child, viewport));\r\n  }\r\n\r\n  return child;\r\n}\r\n","const UPPER_REGEX = /[A-Z]/g;\r\n\r\n// Don't convert these attributes from camelCase to hyphenated-attributes\r\nconst BLACKLIST = [\r\n  'viewBox'\r\n];\r\n\r\nlet keyCase = (key) => {\r\n  if (BLACKLIST.indexOf(key) === -1) {\r\n    key = key.replace(UPPER_REGEX, match => '-' + match.toLowerCase());\r\n  }\r\n  return key;\r\n}\r\n\r\n/**\r\n * Set attributes for a node from a map\r\n *\r\n * @param {Node} node The node to set attributes on\r\n * @param {Object} attributes The map of key/value pairs to use for attributes\r\n */\r\nexport default function setAttributes(node, attributes) {\r\n  Object.keys(attributes).forEach((key) => {\r\n    node.setAttribute(keyCase(key), attributes[key]);\r\n  });\r\n}\r\n","import EventEmitter from 'events';\r\nimport {\r\n  findAnnotationAtPoint,\r\n  findSVGAtPoint\r\n} from './utils';\r\n\r\nconst emitter = new EventEmitter;\r\n\r\nlet clickNode;\r\n\r\n/**\r\n * Handle document.click event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\ndocument.addEventListener('click', function handleDocumentClick(e) {\r\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\r\n\r\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n\r\n  // Emit annotation:blur if clickNode is no longer clicked\r\n  if (clickNode && clickNode !== target) {\r\n    emitter.emit('annotation:blur', clickNode);\r\n  }\r\n\r\n  // Emit annotation:click if target was clicked\r\n  if (target) {\r\n    emitter.emit('annotation:click', target);\r\n  }\r\n\r\n  clickNode = target;\r\n});\r\n\r\n// let mouseOverNode;\r\n// document.addEventListener('mousemove', function handleDocumentMousemove(e) {\r\n//   let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n//\r\n//   // Emit annotation:mouseout if target was mouseout'd\r\n//   if (mouseOverNode && !target) {\r\n//     emitter.emit('annotation:mouseout', mouseOverNode);\r\n//   }\r\n//\r\n//   // Emit annotation:mouseover if target was mouseover'd\r\n//   if (target && mouseOverNode !== target) {\r\n//     emitter.emit('annotation:mouseover', target);\r\n//   }\r\n//\r\n//   mouseOverNode = target;\r\n// });\r\n\r\nexport function fireEvent() { emitter.emit(...arguments); };\r\nexport function addEventListener() { emitter.on(...arguments); };\r\nexport function removeEventListener() { emitter.removeListener(...arguments); };\r\n","const REGEX_HASHLESS_HEX = /^([a-f0-9]{6}|[a-f0-9]{3})$/i;\r\n\r\n/**\r\n * Normalize a color value\r\n *\r\n * @param {String} color The color to normalize\r\n * @return {String}\r\n */\r\nexport default function normalizeColor(color) {\r\n  if (REGEX_HASHLESS_HEX.test(color)) {\r\n    color = `#${color}`;\r\n  }\r\n  return color;\r\n}\r\n","import insertScreenReaderHint from './insertScreenReaderHint';\r\nimport initEventHandlers from './initEventHandlers';\r\n\r\n// TODO This is not the right place for this to live\r\ninitEventHandlers();\r\n\r\n/**\r\n * Insert hints into the DOM for screen readers.\r\n *\r\n * @param {Array} annotations The annotations that hints are inserted for\r\n */\r\nexport default function renderScreenReaderHints(annotations) {\r\n  annotations = Array.isArray(annotations) ? annotations : [];\r\n\r\n  // Insert hints for each type\r\n  Object.keys(SORT_TYPES).forEach((type) => {\r\n    let sortBy = SORT_TYPES[type];\r\n    annotations\r\n      .filter((a) => a.type === type)\r\n      .sort(sortBy)\r\n      .forEach((a, i) => insertScreenReaderHint(a, i + 1));\r\n  });\r\n}\r\n\r\n// Sort annotations first by y, then by x.\r\n// This allows hints to be injected in the order they appear,\r\n// which makes numbering them easier.\r\nfunction sortByPoint(a, b) {\r\n  if (a.y < b.y) {\r\n    return a.x - b.x;\r\n  } else {\r\n    return 1;\r\n  }\r\n}\r\n\r\n// Sort annotation by it's first rectangle\r\nfunction sortByRectPoint(a, b) {\r\n  return sortByPoint(a.rectangles[0], b.rectangles[0]);\r\n}\r\n\r\n// Sort annotation by it's first line\r\nfunction sortByLinePoint(a, b) {\r\n  let lineA = a.lines[0];\r\n  let lineB = b.lines[0];\r\n  return sortByPoint(\r\n    {x: lineA[0], y: lineA[1]},\r\n    {x: lineB[0], y: lineB[1]}\r\n  );\r\n}\r\n\r\n// Arrange supported types and associated sort methods\r\nconst SORT_TYPES = {\r\n  'highlight': sortByRectPoint,\r\n  'strikeout': sortByRectPoint,\r\n  'drawing': sortByLinePoint,\r\n  'textbox': sortByPoint,\r\n  'point': sortByPoint,\r\n  'area': sortByPoint\r\n};\r\n\r\n","import abstractFunction from '../utils/abstractFunction';\r\nimport { fireEvent } from '../UI/event';\r\n\r\n// Adapter should never be invoked publicly\r\nexport default class StoreAdapter {\r\n  /**\r\n   * Create a new StoreAdapter instance\r\n   *\r\n   * @param {Object} [definition] The definition to use for overriding abstract methods\r\n   */\r\n  constructor(definition = {}) {\r\n    // Copy each function from definition if it is a function we know about\r\n    Object.keys(definition).forEach((key) => {\r\n      if (typeof definition[key] === 'function' &&\r\n          typeof this[key] === 'function') {\r\n        this[key] = definition[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get all the annotations for a given document and page number.\r\n   *\r\n   * @param {String} documentId The ID for the document the annotations belong to\r\n   * @param {Number} pageNumber The number of the page the annotations belong to\r\n   * @return {Promise}\r\n   */\r\n  __getAnnotations(documentId, pageNumber) { abstractFunction('getAnnotations'); }\r\n  get getAnnotations() { return this.__getAnnotations; }\r\n  set getAnnotations(fn) {\r\n    this.__getAnnotations = function getAnnotations(documentId, pageNumber) {\r\n      return fn(...arguments).then((annotations) => {\r\n        // TODO may be best to have this happen on the server\r\n        if (annotations.annotations) {\r\n          annotations.annotations.forEach((a) => {\r\n            a.documentId = documentId;\r\n          });\r\n        }\r\n        return annotations;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the definition for a specific annotation.\r\n   *\r\n   * @param {String} documentId The ID for the document the annotation belongs to\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise}\r\n   */\r\n  getAnnotation(documentId, annotationId) { abstractFunction('getAnnotation'); }\r\n\r\n  /**\r\n   * Add an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document to add the annotation to\r\n   * @param {String} pageNumber The page number to add the annotation to\r\n   * @param {Object} annotation The definition for the new annotation\r\n   * @return {Promise}\r\n   */\r\n  __addAnnotation(documentId, pageNumber, annotation) { abstractFunction('addAnnotation'); }\r\n  get addAnnotation() { return this.__addAnnotation; }\r\n  set addAnnotation(fn) {\r\n    this.__addAnnotation = function addAnnotation(documentId, pageNumber, annotation) {\r\n      return fn(...arguments).then((annotation) => {\r\n        fireEvent('annotation:add', documentId, pageNumber, annotation);\r\n        return annotation;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Edit an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} pageNumber the page number of the annotation\r\n   * @param {Object} annotation The definition of the modified annotation\r\n   * @return {Promise}\r\n   */\r\n  __editAnnotation(documentId, pageNumber, annotation) { abstractFunction('editAnnotation'); }\r\n  get editAnnotation() { return this.__editAnnotation; }\r\n  set editAnnotation(fn) {\r\n    this.__editAnnotation = function editAnnotation(documentId, annotationId, annotation) {\r\n      return fn(...arguments).then((annotation) => {\r\n        fireEvent('annotation:edit', documentId, annotationId, annotation);\r\n        return annotation;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise}\r\n   */\r\n  __deleteAnnotation(documentId, annotationId) { abstractFunction('deleteAnnotation'); }\r\n  get deleteAnnotation() { return this.__deleteAnnotation; }\r\n  set deleteAnnotation(fn) {\r\n    this.__deleteAnnotation = function deleteAnnotation(documentId, annotationId) {\r\n      return fn(...arguments).then((success) => {\r\n        if (success) {\r\n          fireEvent('annotation:delete', documentId, annotationId);\r\n        }\r\n        return success;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get all the comments for an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise}\r\n   */\r\n  getComments(documentId, annotationId) { abstractFunction('getComments'); }\r\n\r\n  /**\r\n   * Add a new comment\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @param {Object} content The definition of the comment\r\n   * @return {Promise}\r\n   */\r\n  __addComment(documentId, annotationId, content) { abstractFunction('addComment'); }\r\n  get addComment() { return this.__addComment; }\r\n  set addComment(fn) {\r\n    this.__addComment = function addComment(documentId, annotationId, content) {\r\n      return fn(...arguments).then((comment) => {\r\n        fireEvent('comment:add', documentId, annotationId, comment);\r\n        return comment;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete a comment\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} commentId The ID for the comment\r\n   * @return {Promise}\r\n   */\r\n  __deleteComment(documentId, commentId) { abstractFunction('deleteComment'); }\r\n  get deleteComment() { return this.__deleteComment; }\r\n  set deleteComment(fn) {\r\n    this.__deleteComment = function deleteComment(documentId, commentId) {\r\n      return fn(...arguments).then((success) => {\r\n        if (success) {\r\n          fireEvent('comment:delete', documentId, commentId);\r\n        }\r\n        return success;\r\n      });\r\n    };\r\n  }\r\n}\r\n","import createScreenReaderOnly from './createScreenReaderOnly';\r\nimport insertElementWithinChildren from './insertElementWithinChildren';\r\nimport insertElementWithinElement from './insertElementWithinElement';\r\nimport renderScreenReaderComments from './renderScreenReaderComments';\r\n\r\n// Annotation types that support comments\r\nconst COMMENT_TYPES = ['highlight', 'point', 'area'];\r\n\r\n/**\r\n * Insert a hint into the DOM for screen readers for a specific annotation.\r\n *\r\n * @param {Object} annotation The annotation to insert a hint for\r\n * @param {Number} num The number of the annotation out of all annotations of the same type\r\n */\r\nexport default function insertScreenReaderHint(annotation, num = 0) {\r\n  switch (annotation.type) {\r\n    case 'highlight':\r\n    case 'strikeout':\r\n      let rects = annotation.rectangles;\r\n      let first = rects[0];\r\n      let last = rects[rects.length - 1];\r\n\r\n      insertElementWithinElement(\r\n        createScreenReaderOnly(`Begin ${annotation.type} annotation ${num}`, annotation.uuid),\r\n        first.x, first.y, annotation.page, true\r\n      );\r\n\r\n      insertElementWithinElement(\r\n        createScreenReaderOnly(`End ${annotation.type} annotation ${num}`, `${annotation.uuid}-end`),\r\n        last.x + last.width, last.y, annotation.page, false\r\n      );\r\n      break;\r\n\r\n    case 'textbox':\r\n    case 'point':\r\n      let text = annotation.type === 'textbox' ? ` (content: ${annotation.content})` : '';\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`${annotation.type} annotation ${num}${text}`, annotation.uuid),\r\n        annotation.x, annotation.y, annotation.page\r\n      );\r\n      break;\r\n\r\n    case 'drawing':\r\n    case 'area':\r\n      let x = typeof annotation.x !== 'undefined' ? annotation.x : annotation.lines[0][0];\r\n      let y = typeof annotation.y !== 'undefined' ? annotation.y : annotation.lines[0][1];\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\r\n        x, y, annotation.page\r\n      );\r\n      break;\r\n  }\r\n\r\n  // Include comments in screen reader hint\r\n  if (COMMENT_TYPES.includes(annotation.type)) {\r\n    renderScreenReaderComments(annotation.documentId, annotation.uuid);\r\n  }\r\n}\r\n","import {\r\n  pointIntersectsRect,\r\n  scaleUp,\r\n  scaleDown\r\n} from '../UI/utils'; \r\n\r\n/**\r\n * Insert an element at a point within the document.\r\n * This algorithm will only insert within an element amidst it's text content.\r\n *\r\n * @param {Element} el The element to be inserted\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page number to limit elements to\r\n * @param {Boolean} insertBefore Whether the element is to be inserted before or after x\r\n * @return {Boolean} True if element was able to be inserted, otherwise false\r\n */\r\nexport default function insertElementWithinElement(el, x, y, pageNumber, insertBefore) {\r\n  const OFFSET_ADJUST = 2;\r\n\r\n  // If inserting before adjust `x` by looking for element a few px to the right\r\n  // Otherwise adjust a few px to the left\r\n  // This is to allow a little tolerance by searching within the box, instead\r\n  // of getting a false negative by testing right on the border.\r\n  x = Math.max(x + (OFFSET_ADJUST * (insertBefore ? 1 : -1)), 0);\r\n\r\n  let node = textLayerElementFromPoint(x, y + OFFSET_ADJUST, pageNumber);\r\n  if (!node) {\r\n    return false;\r\n  }\r\n  \r\n  // Now that node has been found inverse the adjustment for `x`.\r\n  // This is done to accomodate tolerance by cutting off on the outside of the\r\n  // text boundary, instead of missing a character by cutting off within.\r\n  x = x + (OFFSET_ADJUST * (insertBefore ? -1 : 1));\r\n\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let left = scaleDown(svg, {left: node.getBoundingClientRect().left}).left - svg.getBoundingClientRect().left;\r\n  let temp = node.cloneNode(true);\r\n  let head = temp.innerHTML.split('');\r\n  let tail = [];\r\n\r\n  // Insert temp off screen\r\n  temp.style.position = 'absolute';\r\n  temp.style.top = '-10000px';\r\n  temp.style.left = '-10000px';\r\n  document.body.appendChild(temp);\r\n\r\n  while (head.length) {\r\n    // Don't insert within HTML tags\r\n    if (head[head.length - 1] === '>') {\r\n      while(head.length) {\r\n        tail.unshift(head.pop());\r\n        if (tail[0] === '<') {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Check if width of temp based on current head value satisfies x\r\n    temp.innerHTML = head.join('');\r\n    let width = scaleDown(svg, {width: temp.getBoundingClientRect().width}).width;\r\n    if (left + width <= x) {\r\n      break;\r\n    }\r\n    tail.unshift(head.pop());\r\n  }\r\n  \r\n  // Update original node with new markup, including element to be inserted\r\n  node.innerHTML = head.join('') + el.outerHTML + tail.join('');\r\n  temp.parentNode.removeChild(temp);\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Get a text layer element at a given point on a page\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page to limit elements to\r\n * @return {Element} First text layer element found at the point\r\n */\r\nfunction textLayerElementFromPoint(x, y, pageNumber) {\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let rect = svg.getBoundingClientRect();\r\n  y = scaleUp(svg, {y}).y + rect.top;\r\n  x = scaleUp(svg, {x}).x + rect.left;\r\n  return [...svg.parentNode.querySelectorAll('.textLayer [data-canvas-width]')].filter((el) => {\r\n    return pointIntersectsRect(x, y, el.getBoundingClientRect());\r\n  })[0];\r\n}\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport insertScreenReaderComment from './insertScreenReaderComment';\r\n\r\n/**\r\n * Insert the comments into the DOM to be available by screen reader\r\n *\r\n * Example output:\r\n *   <div class=\"screenReaderOnly\">\r\n *    <div>Begin highlight 1</div>\r\n *    <ol aria-label=\"Comments\">\r\n *      <li>Foo</li>\r\n *      <li>Bar</li>\r\n *      <li>Baz</li>\r\n *      <li>Qux</li>\r\n *    </ol>\r\n *  </div>\r\n *  <div>Some highlighted text goes here...</div>\r\n *  <div class=\"screenReaderOnly\">End highlight 1</div>\r\n *\r\n * NOTE: `screenReaderOnly` is not a real class, just used for brevity\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The ID of the annotation\r\n * @param {Array} [comments] Optionally preloaded comments to be rendered\r\n * @return {Promise}\r\n */\r\nexport default function renderScreenReaderComments(documentId, annotationId, comments) {\r\n  let promise;\r\n\r\n  if (Array.isArray(comments)) {\r\n    promise = Promise.resolve(comments);\r\n  } else {\r\n    promise = PDFJSAnnotate.getStoreAdapter().getComments(documentId, annotationId);\r\n  }\r\n\r\n  return promise.then((comments) => {\r\n    // Node needs to be found by querying DOM as it may have been inserted as innerHTML\r\n    // leaving `screenReaderNode` as an invalid reference (see `insertElementWithinElement`).\r\n    let node = document.getElementById(`pdf-annotate-screenreader-${annotationId}`);\r\n    if (node) { \r\n      let list = document.createElement('ol');\r\n      list.setAttribute('id', `pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n      list.setAttribute('aria-label', 'Comments');\r\n      node.appendChild(list);\r\n      comments.forEach(insertScreenReaderComment);\r\n    }\r\n  });\r\n}\r\n","/**\r\n * Insert a comment into the DOM to be available by screen reader\r\n *\r\n * @param {Object} comment The comment to be inserted\r\n */\r\nexport default function insertScreenReaderComment(comment) {\r\n  if (!comment) {\r\n    return;\r\n  }\r\n\r\n  let list = document.querySelector(`#pdf-annotate-screenreader-${comment.annotation} ol`);\r\n  if (list) {\r\n    let item = document.createElement('li');\r\n    item.setAttribute('id', `pdf-annotate-screenreader-comment-${comment.uuid}`);\r\n    item.appendChild(document.createTextNode(`${comment.content}`));\r\n    list.appendChild(item);\r\n  }\r\n}\r\n","import PDFJSAnnotate from './src/PDFJSAnnotate';\r\n\r\nexport default PDFJSAnnotate;\r\n","/**\r\n * Throw an Error for an abstract function that hasn't been implemented.\r\n *\r\n * @param {String} name The name of the abstract function\r\n */\r\nexport default function abstractFunction(name) {\r\n  throw new Error(name + ' is not implemented');\r\n}\r\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","module.exports = function createStyleSheet(blocks) {\n  var style = document.createElement('style');\n  var text = Object.keys(blocks).map(function (selector) {\n    return processRuleSet(selector, blocks[selector]);\n  }).join('\\n');\n  \n  style.setAttribute('type', 'text/css');\n  style.appendChild(document.createTextNode(text));\n\n  return style;\n}\n\nfunction processRuleSet(selector, block) {\n  return selector + ' {\\n' + processDeclarationBlock(block) + '\\n}';\n}\n\nfunction processDeclarationBlock(block) {\n  return Object.keys(block).map(function (prop) {\n    return processDeclaration(prop, block[prop]);\n  }).join('\\n');\n}\n\nfunction processDeclaration(prop, value) {\n  if (!isNaN(value) && value != 0) {\n    value = value + 'px';\n  }\n\n  return hyphenate(prop) + ': ' + value + ';';\n}\n\nfunction hyphenate(prop) {\n  return prop.replace(/[A-Z]/g, function (match) {\n    return '-' + match.toLowerCase();\n  });\n}\n","import uuid from '../utils/uuid';\r\nimport StoreAdapter from './StoreAdapter';\r\n\r\n// StoreAdapter for working with localStorage\r\n// This is ideal for testing, examples, and prototyping\r\nexport default class LocalStoreAdapter extends StoreAdapter {\r\n  constructor() {\r\n    super({\r\n      getAnnotations(documentId, pageNumber) {\r\n        return new Promise((resolve, reject) => {\r\n          let annotations = getAnnotations(documentId).filter((i) => {\r\n            return i.page === pageNumber && i.class === 'Annotation';\r\n          });\r\n\r\n          resolve({\r\n            documentId,\r\n            pageNumber,\r\n            annotations\r\n          });\r\n        });\r\n      },\r\n\r\n      getAnnotation(documentId, annotationId) {\r\n        return Promise.resolve(getAnnotations(documentId)[findAnnotation(documentId, annotationId)]);\r\n      },\r\n\r\n      addAnnotation(documentId, pageNumber, annotation) {\r\n        return new Promise((resolve, reject) => {\r\n          annotation.class = 'Annotation';\r\n          annotation.uuid = uuid();\r\n          annotation.page = pageNumber;\r\n\r\n          let annotations = getAnnotations(documentId);\r\n          annotations.push(annotation);\r\n          updateAnnotations(documentId, annotations);\r\n\r\n          resolve(annotation);\r\n        });\r\n      },\r\n\r\n      editAnnotation(documentId, annotationId, annotation) {\r\n        return new Promise((resolve, reject) => {\r\n          let annotations = getAnnotations(documentId);\r\n          annotations[findAnnotation(documentId, annotationId)] = annotation;\r\n          updateAnnotations(documentId, annotations);\r\n\r\n          resolve(annotation);\r\n        });\r\n      },\r\n\r\n      deleteAnnotation(documentId, annotationId) {\r\n        return new Promise((resolve, reject) => {\r\n          let index = findAnnotation(documentId, annotationId);\r\n          if (index > -1) {\r\n            let annotations = getAnnotations(documentId);\r\n            annotations.splice(index, 1);\r\n            updateAnnotations(documentId, annotations);\r\n          }\r\n\r\n          resolve(true);\r\n        });\r\n      },\r\n\r\n      getComments(documentId, annotationId) {\r\n        return new Promise((resolve, reject) => {\r\n          resolve(getAnnotations(documentId).filter((i) => {\r\n            return i.class === 'Comment' && i.annotation === annotationId;\r\n          }));\r\n        });\r\n      },\r\n\r\n      addComment(documentId, annotationId, content) {\r\n        return new Promise((resolve, reject) => {\r\n          let comment = {\r\n            class: 'Comment',\r\n            uuid: uuid(),\r\n            annotation: annotationId,\r\n            content: content\r\n          };\r\n\r\n          let annotations = getAnnotations(documentId);\r\n          annotations.push(comment);\r\n          updateAnnotations(documentId, annotations);\r\n\r\n          resolve(comment);\r\n        });\r\n      },\r\n\r\n      deleteComment(documentId, commentId) {\r\n        return new Promise((resolve, reject) => {\r\n          getAnnotations(documentId);\r\n          let index = -1;\r\n          let annotations = getAnnotations(documentId);\r\n          for (let i=0, l=annotations.length; i<l; i++) {\r\n            if (annotations[i].uuid === commentId) {\r\n              index = i;\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (index > -1) {\r\n            annotations.splice(index, 1);\r\n            updateAnnotations(documentId, annotations);\r\n          }\r\n\r\n          resolve(true);\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction getAnnotations(documentId) {\r\n  return JSON.parse(localStorage.getItem(`${documentId}/annotations`)) || [];\r\n}\r\n\r\nfunction updateAnnotations(documentId, annotations) {\r\n  localStorage.setItem(`${documentId}/annotations`, JSON.stringify(annotations));\r\n}\r\n\r\nfunction findAnnotation(documentId, annotationId) {\r\n  let index = -1;\r\n  let annotations = getAnnotations(documentId);\r\n  for (let i=0, l=annotations.length; i<l; i++) {\r\n    if (annotations[i].uuid === annotationId) {\r\n      index = i;\r\n      break;\r\n    }\r\n  }\r\n  return index;\r\n}\r\n","const REGEXP = /[xy]/g\r\nconst PATTERN = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\r\n\r\nfunction replacement(c) {\r\n  let r = Math.random()*16|0;\r\n  let v = c == 'x' ? r : (r&0x3|0x8);\r\n  return v.toString(16);\r\n}\r\n\r\n/**\r\n * Generate a univierally unique identifier\r\n *\r\n * @return {String}\r\n */\r\nexport default function uuid() {\r\n  return PATTERN.replace(REGEXP, replacement);\r\n}\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from './appendChild';\r\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\r\n\r\n/**\r\n * Render the response from PDFJSAnnotate.getStoreAdapter().getAnnotations to SVG\r\n *\r\n * @param {SVGElement} svg The SVG element to render the annotations to\r\n * @param {Object} viewport The page viewport data\r\n * @param {Object} data The response from PDFJSAnnotate.getStoreAdapter().getAnnotations\r\n * @return {Promise} Settled once rendering has completed\r\n *  A settled Promise will be either:\r\n *    - fulfilled: SVGElement\r\n *    - rejected: Error\r\n */\r\nexport default function render(svg, viewport, data) {\r\n  return new Promise((resolve, reject) => {\r\n    // Reset the content of the SVG\r\n    svg.innerHTML = ''; \r\n    svg.setAttribute('data-pdf-annotate-container', true);\r\n    svg.setAttribute('data-pdf-annotate-viewport', JSON.stringify(viewport));\r\n    svg.removeAttribute('data-pdf-annotate-document');\r\n    svg.removeAttribute('data-pdf-annotate-page');\r\n\r\n    // If there's no data nothing can be done\r\n    if (!data) {\r\n      return resolve(svg);\r\n    }\r\n\r\n    svg.setAttribute('data-pdf-annotate-document', data.documentId);\r\n    svg.setAttribute('data-pdf-annotate-page', data.pageNumber);\r\n  \r\n    // Make sure annotations is an array\r\n    if (!Array.isArray(data.annotations) || data.annotations.length === 0) {\r\n      return resolve(svg);\r\n    }\r\n\r\n    // Append annotation to svg\r\n    data.annotations.forEach((a) => {\r\n      appendChild(svg, a, viewport);\r\n    });\r\n\r\n    resolve(svg);\r\n  });\r\n}\r\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGLineElements from an annotation definition.\r\n * This is used for anntations of type `strikeout`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement} A group of all lines to be rendered\r\n */\r\nexport default function renderLine(a) {\r\n  let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n  setAttributes(group, {\r\n    stroke: normalizeColor(a.color || '#f00'),\r\n    strokeWidth: 1\r\n  });\r\n\r\n  a.rectangles.forEach((r) => {\r\n    let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\r\n\r\n    setAttributes(line, {\r\n      x1: r.x,\r\n      y1: r.y,\r\n      x2: r.x + r.width,\r\n      y2: r.y,\r\n    });\r\n\r\n    group.appendChild(line);\r\n  });\r\n\r\n  return group;\r\n}\r\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGPathElement from an annotation definition.\r\n * This is used for anntations of type `drawing`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGPathElement} The path to be rendered\r\n */\r\nexport default function renderPath(a) {\r\n  let d = [];\r\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n  \r\n  for (let i=0, l=a.lines.length; i<l; i++) {\r\n    var p1 = a.lines[i];\r\n    var p2 = a.lines[i+1];\r\n    if (p2) {\r\n      d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\r\n    }\r\n  }\r\n  \r\n  setAttributes(path, {\r\n    d: `${d.join(' ')}Z`,\r\n    stroke: normalizeColor(a.color || '#000'),\r\n    strokeWidth: a.width || 1,\r\n    fill: 'none'\r\n  });\r\n\r\n  return path;\r\n}\r\n","import setAttributes from '../utils/setAttributes';\r\n\r\nconst SIZE = 25;\r\nconst D = 'M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z';\r\n\r\n/**\r\n * Create SVGElement from an annotation definition.\r\n * This is used for anntations of type `comment`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGElement} A svg to be rendered\r\n */\r\nexport default function renderPoint(a) {\r\n  let outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  let innerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n\r\n  setAttributes(outerSVG,  {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    x: a.x,\r\n    y: a.y\r\n  });\r\n\r\n  setAttributes(innerSVG, {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    x: 0,\r\n    y: (SIZE * 0.05) * -1,\r\n    viewBox: '0 0 1000 1000'\r\n  });\r\n\r\n  setAttributes(rect, {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    stroke: '#000',\r\n    fill: '#ff0'\r\n  });\r\n\r\n  setAttributes(path, {\r\n    d: D,\r\n    strokeWidth: 50,\r\n    stroke: '#000',\r\n    fill: '#fff'\r\n  });\r\n\r\n  innerSVG.appendChild(path);\r\n  outerSVG.appendChild(rect);\r\n  outerSVG.appendChild(innerSVG);\r\n\r\n  return outerSVG;\r\n}\r\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGRectElements from an annotation definition.\r\n * This is used for anntations of type `area` and `highlight`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement|SVGRectElement} A group of all rects to be rendered\r\n */\r\nexport default function renderRect(a) {\r\n  if (a.type === 'highlight') {\r\n    let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n    setAttributes(group, {\r\n      fill: normalizeColor(a.color || '#ff0'),\r\n      fillOpacity: 0.2\r\n    });\r\n    \r\n    a.rectangles.forEach((r) => {\r\n      group.appendChild(createRect(r));\r\n    });\r\n\r\n    return group;\r\n  } else {\r\n    let rect = createRect(a);\r\n    setAttributes(rect, {\r\n      stroke: normalizeColor(a.color || '#f00'),\r\n      fill: 'none'\r\n    });\r\n\r\n    return rect;\r\n  }\r\n}\r\n\r\nfunction createRect(r) {\r\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n\r\n  setAttributes(rect, {\r\n    x: r.x,\r\n    y: r.y,\r\n    width: r.width,\r\n    height: r.height\r\n  });\r\n\r\n  return rect;\r\n}\r\n","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGTextElement from an annotation definition.\r\n * This is used for anntations of type `textbox`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGTextElement} A text to be rendered\r\n */\r\nexport default function renderText(a) {\r\n  var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\r\n\r\n  setAttributes(text, {\r\n    x: a.x,\r\n    y: a.y + parseInt(a.size, 10),\r\n    fill: normalizeColor(a.color || '#000'),\r\n    fontSize: a.size\r\n  });\r\n  text.innerHTML = a.content;\r\n\r\n  return text;\r\n}\r\n","/**\r\n * Create a node that is only visible to screen readers\r\n *\r\n * @param {String} content The text content that should be read by screen reader\r\n * @param {String} [annotationId] The ID of the annotation assocaited\r\n * @return {Element} An Element that is only visible to screen readers\r\n */\r\nexport default function createScreenReaderOnly(content, annotationId) {\r\n  let node = document.createElement('div');\r\n  let text = document.createTextNode(content);\r\n  node.appendChild(text);\r\n  node.setAttribute('id', `pdf-annotate-screenreader-${annotationId}`);\r\n  node.style.position = 'absolute';\r\n  node.style.left = '-10000px';\r\n  node.style.top = 'auto';\r\n  node.style.width = '1px';\r\n  node.style.height = '1px';\r\n  node.style.overflow = 'hidden';\r\n  return node;\r\n}\r\n","import insertElementWithinElement from './insertElementWithinElement';\r\nimport { pointIntersectsRect } from '../UI/utils';\r\nimport { scaleUp } from '../UI/utils'; \r\n\r\n/**\r\n * Insert an element at a point within the document.\r\n * This algorithm will try to insert between elements if possible.\r\n * It will however use `insertElementWithinElement` if it is more accurate.\r\n *\r\n * @param {Element} el The element to be inserted\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page number to limit elements to\r\n * @return {Boolean} True if element was able to be inserted, otherwise false\r\n */\r\nexport default function insertElementWithinChildren(el, x, y, pageNumber) {\r\n  // Try and use most accurate method of inserting within an element\r\n  if (insertElementWithinElement(el, x, y, pageNumber, true)) {\r\n    return true;\r\n  }\r\n\r\n  // Fall back to inserting between elements\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let rect = svg.getBoundingClientRect();\r\n  let nodes = [...svg.parentNode.querySelectorAll('.textLayer > div')];\r\n\r\n  y = scaleUp(svg, {y}).y + rect.top;\r\n  x = scaleUp(svg, {x}).x + rect.left;\r\n\r\n  // Find the best node to insert before\r\n  for (let i=0, l=nodes.length; i<l; i++) {\r\n    let n = nodes[i];\r\n    let r = n.getBoundingClientRect();\r\n    if (y <= r.top) {\r\n      n.parentNode.insertBefore(el, n);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  // If all else fails try to append to the bottom\r\n  let textLayer = svg.parentNode.querySelector('.textLayer');\r\n  if (textLayer) {\r\n    let textRect = textLayer.getBoundingClientRect();\r\n    if (pointIntersectsRect(x, y, textRect)) {\r\n      textLayer.appendChild(el);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","import insertScreenReaderHint from './insertScreenReaderHint';\r\nimport renderScreenReaderHints from './renderScreenReaderHints';\r\nimport insertScreenReaderComment from './insertScreenReaderComment';\r\nimport renderScreenReaderComments from './renderScreenReaderComments';\r\nimport { addEventListener } from '../UI/event';\r\nimport PDFJSAnnotate from '../PDFJSAnnotate';\r\n\r\n/**\r\n * Initialize the event handlers for keeping screen reader hints synced with data\r\n */\r\nexport default function initEventHandlers() {\r\n  addEventListener('annotation:add', (documentId, pageNumber, annotation) => {\r\n    reorderAnnotationsByType(documentId, pageNumber, annotation.type);\r\n  });\r\n  addEventListener('annotation:edit', (documentId, annotationId, annotation) => {\r\n    reorderAnnotationsByType(documentId, annotation.page, annotation.type);\r\n  });\r\n  addEventListener('annotation:delete', removeAnnotation);\r\n  addEventListener('comment:add', insertComment);\r\n  addEventListener('comment:delete', removeComment);\r\n}\r\n\r\n/**\r\n * Reorder the annotation numbers by annotation type\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {Number} pageNumber The page number of the annotations\r\n * @param {Strig} type The annotation type\r\n */\r\nfunction reorderAnnotationsByType(documentId, pageNumber, type) {\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotations(documentId, pageNumber)\r\n    .then((annotations) => {\r\n      return annotations.annotations.filter((a) => {\r\n        return a.type === type;\r\n      });\r\n    })\r\n    .then((annotations) => {\r\n      annotations.forEach((a) => {\r\n        removeAnnotation(documentId, a.uuid);\r\n      });\r\n\r\n      return annotations;\r\n    })\r\n    .then(renderScreenReaderHints);\r\n}\r\n\r\n/**\r\n * Remove the screen reader hint for an annotation\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The Id of the annotation\r\n */\r\nfunction removeAnnotation(documentId, annotationId) {\r\n  removeElementById(`pdf-annotate-screenreader-${annotationId}`);\r\n  removeElementById(`pdf-annotate-screenreader-${annotationId}-end`);\r\n}\r\n\r\n/**\r\n * Insert a screen reader hint for a comment\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The ID of tha assocated annotation\r\n * @param {Object} comment The comment to insert a hint for\r\n */\r\nfunction insertComment(documentId, annotationId, comment) {\r\n  let list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n  let promise;\r\n\r\n  if (!list) {\r\n    promise = renderScreenReaderComments(documentId, annotationId, []).then(() => {\r\n      list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n      return true;\r\n    });\r\n  } else {\r\n    promise = Promise.resolve(true);\r\n  }\r\n\r\n  promise.then(() => {\r\n    insertScreenReaderComment(comment);\r\n  });\r\n}\r\n\r\n/**\r\n * Remove a screen reader hint for a comment\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} commentId The ID of the comment\r\n */\r\nfunction removeComment(documentId, commentId) {\r\n  removeElementById(`pdf-annotate-screenreader-comment-${commentId}`);\r\n}\r\n\r\n/**\r\n * Remove an element from the DOM by it's ID if it exists\r\n *\r\n * @param {String} elementID The ID of the element to be removed\r\n */\r\nfunction removeElementById(elementId) {\r\n  let el = document.getElementById(elementId);\r\n  if (el) {\r\n    el.parentNode.removeChild(el);\r\n  }\r\n}\r\n","import { addEventListener, removeEventListener, fireEvent } from './event';\r\nimport { disableEdit, enableEdit } from './edit';\r\nimport { disablePen, enablePen, setPen } from './pen';\r\nimport { disablePoint, enablePoint } from './point';\r\nimport { disableRect, enableRect } from './rect';\r\nimport { disableText, enableText, setText } from './text';\r\nimport { createPage, renderPage } from './page';\r\n\r\nexport default {\r\n  addEventListener, removeEventListener, fireEvent,\r\n  disableEdit, enableEdit,\r\n  disablePen, enablePen, setPen,\r\n  disablePoint, enablePoint,\r\n  disableRect, enableRect,\r\n  disableText, enableText, setText,\r\n  createPage, renderPage\r\n};\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\n\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  addEventListener,\r\n  removeEventListener\r\n} from './event';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGContainer,\r\n  findSVGAtPoint,\r\n  getAnnotationRect,\r\n  getMetadata,\r\n  scaleDown,\r\n  scaleUp\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet isDragging = false, overlay;\r\nlet dragOffsetX, dragOffsetY, dragStartX, dragStartY;\r\nconst OVERLAY_BORDER_SIZE = 3;\r\n\r\n/**\r\n * Create an overlay for editing an annotation.\r\n *\r\n * @param {Element} target The annotation element to apply overlay for\r\n */\r\nfunction createEditOverlay(target) {\r\n  destroyEditOverlay();\r\n\r\n  overlay = document.createElement('div');\r\n  let anchor = document.createElement('a');\r\n  let parentNode = findSVGContainer(target).parentNode;\r\n  let id = target.getAttribute('data-pdf-annotate-id');\r\n  let rect = getAnnotationRect(target);\r\n  let styleLeft = rect.left - OVERLAY_BORDER_SIZE;\r\n  let styleTop = rect.top - OVERLAY_BORDER_SIZE;\r\n  \r\n  overlay.setAttribute('id', 'pdf-annotate-edit-overlay');\r\n  overlay.setAttribute('data-target-id', id);\r\n  overlay.style.boxSizing = 'content-box';\r\n  overlay.style.position = 'absolute';\r\n  overlay.style.top = `${styleTop}px`;\r\n  overlay.style.left = `${styleLeft}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n  overlay.style.border = `${OVERLAY_BORDER_SIZE}px solid ${BORDER_COLOR}`;\r\n  overlay.style.borderRadius = `${OVERLAY_BORDER_SIZE}px`;\r\n\r\n  anchor.innerHTML = '×';\r\n  anchor.setAttribute('href', 'javascript://');\r\n  anchor.style.background = '#fff';\r\n  anchor.style.borderRadius = '20px';\r\n  anchor.style.border = '1px solid #bbb';\r\n  anchor.style.color = '#bbb';\r\n  anchor.style.fontSize = '16px';\r\n  anchor.style.padding = '2px';\r\n  anchor.style.textAlign = 'center';\r\n  anchor.style.textDecoration = 'none';\r\n  anchor.style.position = 'absolute';\r\n  anchor.style.top = '-13px';\r\n  anchor.style.right = '-13px';\r\n  anchor.style.width = '25px';\r\n  anchor.style.height = '25px';\r\n  \r\n  overlay.appendChild(anchor);\r\n  parentNode.appendChild(overlay);\r\n  document.addEventListener('click', handleDocumentClick);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  anchor.addEventListener('click', deleteAnnotation);\r\n  anchor.addEventListener('mouseover', () => {\r\n    anchor.style.color = '#35A4DC';\r\n    anchor.style.borderColor = '#999';\r\n    anchor.style.boxShadow = '0 1px 1px #ccc';\r\n  });\r\n  anchor.addEventListener('mouseout', () => {\r\n    anchor.style.color = '#bbb';\r\n    anchor.style.borderColor = '#bbb';\r\n    anchor.style.boxShadow = '';\r\n  });\r\n  overlay.addEventListener('mouseover', () => {\r\n    if (!isDragging) { anchor.style.display = ''; }\r\n  });\r\n  overlay.addEventListener('mouseout', () => {\r\n    anchor.style.display = 'none';\r\n  });\r\n}\r\n\r\n/**\r\n * Destroy the edit overlay if it exists.\r\n */\r\nfunction destroyEditOverlay() {\r\n  if (overlay) {\r\n    overlay.parentNode.removeChild(overlay);\r\n    overlay = null;\r\n  }\r\n\r\n  document.removeEventListener('click', handleDocumentClick);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  enableUserSelect();\r\n}\r\n\r\n/**\r\n * Delete currently selected annotation\r\n */\r\nfunction deleteAnnotation() {\r\n  if (!overlay) { return; }\r\n\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n  let { documentId } = getMetadata(svg);\r\n\r\n  [...nodes].forEach((n) => {\r\n    n.parentNode.removeChild(n);\r\n  });\r\n  \r\n  PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId);\r\n\r\n  destroyEditOverlay();\r\n}\r\n\r\n/**\r\n * Handle document.click event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentClick(e) {\r\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\r\n\r\n  // Remove current overlay\r\n  let overlay = document.getElementById('pdf-annotate-edit-overlay');\r\n  if (overlay) {\r\n    if (isDragging || e.target === overlay) {\r\n      return;\r\n    }\r\n\r\n    destroyEditOverlay();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  if (overlay && e.keyCode === 46 &&\r\n      e.target.nodeName.toLowerCase() !== 'textarea' &&\r\n      e.target.nodeName.toLowerCase() !== 'input') {\r\n    deleteAnnotation();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mousedown event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  if (e.target !== overlay) { return; }\r\n\r\n  // Highlight and strikeout annotations are bound to text within the document.\r\n  // It doesn't make sense to allow repositioning these types of annotations.\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let target = document.querySelector(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let type = target.getAttribute('data-pdf-annotate-type');\r\n\r\n  if (type === 'highlight' || type === 'strikeout') { return; }\r\n\r\n  isDragging = true;\r\n  dragOffsetX = e.clientX;\r\n  dragOffsetY = e.clientY;\r\n  dragStartX = overlay.offsetLeft;\r\n  dragStartY = overlay.offsetTop;\r\n\r\n  overlay.style.background = 'rgba(255, 255, 255, 0.7)';\r\n  overlay.style.cursor = 'move';\r\n  overlay.querySelector('a').style.display = 'none';\r\n\r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let parentNode = overlay.parentNode;\r\n  let rect = parentNode.getBoundingClientRect();\r\n  let y = (dragStartY + (e.clientY - dragOffsetY));\r\n  let x = (dragStartX + (e.clientX - dragOffsetX));\r\n  let minY = 0;\r\n  let maxY = rect.height;\r\n  let minX = 0;\r\n  let maxX = rect.width;\r\n\r\n  if (y > minY && y + overlay.offsetHeight < maxY) {\r\n    overlay.style.top = `${y}px`;\r\n  }\r\n\r\n  if (x > minX && x + overlay.offsetWidth < maxX) {\r\n    overlay.style.left = `${x}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let target = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let type = target[0].getAttribute('data-pdf-annotate-type');\r\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n  let { documentId } = getMetadata(svg);\r\n  \r\n  overlay.querySelector('a').style.display = '';\r\n\r\n  function getDelta(propX, propY) {\r\n    return calcDelta(parseInt(target[0].getAttribute(propX), 10), parseInt(target[0].getAttribute(propY), 10));\r\n  }\r\n\r\n  function calcDelta(x, y) {\r\n    return {\r\n      deltaX: OVERLAY_BORDER_SIZE + scaleDown(svg, {x: overlay.offsetLeft}).x - x,\r\n      deltaY: OVERLAY_BORDER_SIZE + scaleDown(svg, {y: overlay.offsetTop}).y - y\r\n    };\r\n  }\r\n\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId).then((annotation) => {\r\n    if (['area', 'highlight', 'point', 'textbox'].indexOf(type) > -1) {\r\n      let { deltaX, deltaY } = getDelta('x', 'y');\r\n      [...target].forEach((t, i) => {\r\n        if (deltaY !== 0) {\r\n          let modelY = parseInt(t.getAttribute('y'), 10) + deltaY;\r\n          let viewY = modelY;\r\n\r\n          if (type === 'textbox') {\r\n            viewY += annotation.size;\r\n          }\r\n\r\n          if (type === 'point') {\r\n            viewY = scaleUp(svg, { viewY }).viewY;\r\n          }\r\n\r\n          t.setAttribute('y', viewY);\r\n          if (annotation.rectangles) {\r\n            annotation.rectangles[i].y = modelY;\r\n          } else if (annotation.y) {\r\n            annotation.y = modelY;\r\n          }\r\n        }\r\n        if (deltaX !== 0) {\r\n          let modelX = parseInt(t.getAttribute('x'), 10) + deltaX;\r\n          let viewX = modelX;\r\n\r\n          if (type === 'point') {\r\n            viewX = scaleUp(svg, { viewX }).viewX;\r\n          }\r\n\r\n          t.setAttribute('x', viewX);\r\n          if (annotation.rectangles) {\r\n            annotation.rectangles[i].x = modelX;\r\n          } else if (annotation.x) {\r\n            annotation.x = modelX;\r\n          }\r\n        }\r\n      });\r\n    // } else if (type === 'strikeout') {\r\n    //   let { deltaX, deltaY } = getDelta('x1', 'y1');\r\n    //   [...target].forEach(target, (t, i) => {\r\n    //     if (deltaY !== 0) {\r\n    //       t.setAttribute('y1', parseInt(t.getAttribute('y1'), 10) + deltaY);\r\n    //       t.setAttribute('y2', parseInt(t.getAttribute('y2'), 10) + deltaY);\r\n    //       annotation.rectangles[i].y = parseInt(t.getAttribute('y1'), 10);\r\n    //     }\r\n    //     if (deltaX !== 0) {\r\n    //       t.setAttribute('x1', parseInt(t.getAttribute('x1'), 10) + deltaX);\r\n    //       t.setAttribute('x2', parseInt(t.getAttribute('x2'), 10) + deltaX);\r\n    //       annotation.rectangles[i].x = parseInt(t.getAttribute('x1'), 10);\r\n    //     }\r\n    //   });\r\n    } else if (type === 'drawing') {\r\n      let rect = scaleDown(svg, getAnnotationRect(target[0]));\r\n      let [originX, originY] = annotation.lines[0];\r\n      let { deltaX, deltaY } = calcDelta(originX, originY);\r\n\r\n      // origin isn't necessarily at 0/0 in relation to overlay x/y\r\n      // adjust the difference between overlay and drawing coords\r\n      deltaY += (originY - rect.top);\r\n      deltaX += (originX - rect.left);\r\n\r\n      annotation.lines.forEach((line, i) => {\r\n        let [x, y] = annotation.lines[i];\r\n        annotation.lines[i][0] = x + deltaX;\r\n        annotation.lines[i][1] = y + deltaY;\r\n      });\r\n\r\n      target[0].parentNode.removeChild(target[0]);\r\n      appendChild(svg, annotation);\r\n    }\r\n\r\n    PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\r\n  });\r\n\r\n  setTimeout(() => {\r\n    isDragging = false;\r\n  }, 0);\r\n\r\n  overlay.style.background = '';\r\n  overlay.style.cursor = '';\r\n\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  enableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle annotation.click event\r\n *\r\n * @param {Element} e The annotation element that was clicked\r\n */\r\nfunction handleAnnotationClick(target) {\r\n  createEditOverlay(target);\r\n}\r\n\r\n/**\r\n * Enable edit mode behavior.\r\n */\r\nexport function enableEdit () {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  addEventListener('annotation:click', handleAnnotationClick);\r\n};\r\n\r\n/**\r\n * Disable edit mode behavior.\r\n */\r\nexport function disableEdit () {\r\n  destroyEditOverlay();\r\n\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  removeEventListener('annotation:click', handleAnnotationClick);\r\n};\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  scaleDown\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _penSize;\r\nlet _penColor;\r\nlet path;\r\nlet lines;\r\n\r\n/**\r\n * Handle document.mousedown event\r\n */\r\nfunction handleDocumentMousedown() {\r\n  path = null;\r\n  lines = [];\r\n\r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let svg;\r\n  if (lines.length > 1 && (svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\r\n        type: 'drawing',\r\n        width: _penSize,\r\n        color: _penColor,\r\n        lines\r\n      }\r\n    ).then((annotation) => {\r\n      if (path) {\r\n        svg.removeChild(path);\r\n      }\r\n\r\n      appendChild(svg, annotation);\r\n    });\r\n  }\r\n\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  savePoint(e.clientX, e.clientY);\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    lines = null;\r\n    path.parentNode.removeChild(path);\r\n    document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  }\r\n}\r\n\r\n/**\r\n * Save a point to the line being drawn.\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n */\r\nfunction savePoint(x, y) {\r\n  let svg = findSVGAtPoint(x, y);\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  let point = scaleDown(svg, {\r\n    x: x - rect.left,\r\n    y: y - rect.top\r\n  });\r\n\r\n  lines.push([point.x, point.y]);\r\n\r\n  if (lines.length <= 1) {\r\n    return;\r\n  }\r\n\r\n  if (path) {\r\n    svg.removeChild(path);\r\n  }\r\n\r\n  path = appendChild(svg, {\r\n    type: 'drawing',\r\n    color: _penColor,\r\n    width: _penSize,\r\n    lines\r\n  });\r\n}\r\n\r\n/**\r\n * Set the attributes of the pen.\r\n *\r\n * @param {Number} penSize The size of the lines drawn by the pen\r\n * @param {String} penColor The color of the lines drawn by the pen\r\n */\r\nexport function setPen(penSize = 1, penColor = '000000') {\r\n  _penSize = parseInt(penSize, 10);\r\n  _penColor = penColor;\r\n}\r\n\r\n/**\r\n * Enable the pen behavior\r\n */\r\nexport function enablePen() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Disable the pen behavior\r\n */\r\nexport function disablePen() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  enableUserSelect();\r\n}\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  scaleDown\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet input;\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} The DOM event to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return\r\n  }\r\n\r\n  input = document.createElement('input');\r\n  input.setAttribute('id', 'pdf-annotate-point-input');\r\n  input.setAttribute('placeholder', 'Enter comment');\r\n  input.style.border = `3px solid ${BORDER_COLOR}`;\r\n  input.style.borderRadius = '3px';\r\n  input.style.position = 'absolute';\r\n  input.style.top = `${e.clientY}px`;\r\n  input.style.left = `${e.clientX}px`;\r\n\r\n  input.addEventListener('blur', handleInputBlur);\r\n  input.addEventListener('keyup', handleInputKeyup);\r\n\r\n  document.body.appendChild(input);\r\n  input.focus();\r\n}\r\n\r\n/**\r\n * Handle input.blur event\r\n */\r\nfunction handleInputBlur() {\r\n  savePoint();\r\n}\r\n\r\n/**\r\n * Handle input.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleInputKeyup(e) {\r\n  if (e.keyCode === 27) {\r\n    closeInput();\r\n  } else if (e.keyCode === 13) {\r\n    savePoint();\r\n  }\r\n}\r\n\r\n/**\r\n * Save a new point annotation from input\r\n */\r\nfunction savePoint() {\r\n  if (input.value.trim().length > 0) {\r\n    let clientX = parseInt(input.style.left, 10);\r\n    let clientY = parseInt(input.style.top, 10);\r\n    let content = input.value.trim();\r\n    let svg = findSVGAtPoint(clientX, clientY);\r\n    if (!svg) {\r\n      return;\r\n    }\r\n\r\n    let rect = svg.getBoundingClientRect();\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n    let annotation = Object.assign({\r\n      type: 'point'\r\n    }, scaleDown(svg, {\r\n      x: clientX - rect.left,\r\n      y: clientY - rect.top\r\n    })\r\n    );\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n      .then((annotation) => {\r\n        PDFJSAnnotate.getStoreAdapter().addComment(\r\n          documentId,\r\n          annotation.uuid,\r\n          content\r\n        );\r\n\r\n        appendChild(svg, annotation);\r\n      });\r\n  }\r\n\r\n  closeInput();\r\n}\r\n\r\n/**\r\n * Close the input element\r\n */\r\nfunction closeInput() {\r\n  try {\r\n    input.removeEventListener('blur', handleInputBlur);\r\n    input.removeEventListener('keyup', handleInputKeyup);\r\n    document.body.removeChild(input);\r\n    input = null;\r\n  } catch (e) {\r\n\r\n  }\r\n}\r\n\r\n/**\r\n * Enable point annotation behavior\r\n */\r\nexport function enablePoint() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Disable point annotation behavior\r\n */\r\nexport function disablePoint() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  getOffset,\r\n  scaleDown,\r\n  scaleUp\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _type;\r\nlet overlay;\r\nlet originY;\r\nlet originX;\r\n\r\n/**\r\n * Get the current window selection as rects\r\n *\r\n * @return {Array} An Array of rects\r\n */\r\nfunction getSelectionRects() {\r\n  try {\r\n    let selection = window.getSelection();\r\n    let range = selection.getRangeAt(0);\r\n    let rects = range.getClientRects();\r\n\r\n    if (rects.length > 0 &&\r\n        rects[0].width > 0 &&\r\n        rects[0].height > 0) {\r\n      return rects;\r\n    }\r\n  } catch (e) {}\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Handle document.mousedown event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  let svg;\r\n  if (_type !== 'area' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  originY = e.clientY;\r\n  originX = e.clientX;\r\n\r\n  overlay = document.createElement('div');\r\n  overlay.style.position = 'absolute';\r\n  overlay.style.top = `${originY - rect.top}px`;\r\n  overlay.style.left = `${originX - rect.left}px`;\r\n  overlay.style.border = `3px solid ${BORDER_COLOR}`;\r\n  overlay.style.borderRadius = '3px';\r\n  svg.parentNode.appendChild(overlay);\r\n  \r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n  let rect = svg.getBoundingClientRect();\r\n\r\n  if (originX + (e.clientX - originX) < rect.right) {\r\n    overlay.style.width = `${e.clientX - originX}px`;\r\n  }\r\n\r\n  if (originY + (e.clientY - originY) < rect.bottom) {\r\n    overlay.style.height = `${e.clientY - originY}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let rects;\r\n  if (_type !== 'area' && (rects = getSelectionRects())) {\r\n    let svg = findSVGAtPoint(rects[0].left, rects[0].top);\r\n    saveRect(_type, [...rects].map((r) => {\r\n      return {\r\n        top: r.top,\r\n        left: r.left,\r\n        width: r.width,\r\n        height: r.height\r\n      };\r\n    }));\r\n  } else if (_type === 'area' && overlay) {\r\n    let svg = overlay.parentNode.querySelector('svg.annotationLayer');\r\n    let rect = svg.getBoundingClientRect();\r\n    saveRect(_type, [{\r\n      top: parseInt(overlay.style.top, 10) + rect.top,\r\n      left: parseInt(overlay.style.left, 10) + rect.left,\r\n      width: parseInt(overlay.style.width, 10),\r\n      height: parseInt(overlay.style.height, 10)\r\n    }]);\r\n\r\n    overlay.parentNode.removeChild(overlay);\r\n    overlay = null;\r\n\r\n    document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    enableUserSelect();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    let selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    if (overlay && overlay.parentNode) {\r\n      overlay.parentNode.removeChild(overlay);\r\n      overlay = null;\r\n      document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Save a rect annotation\r\n *\r\n * @param {String} type The type of rect (area, highlight, strikeout)\r\n * @param {Array} rects The rects to use for annotation\r\n * @param {String} color The color of the rects\r\n */\r\nfunction saveRect(type, rects, color) {\r\n  let svg = findSVGAtPoint(rects[0].left, rects[0].top);\r\n  let node;\r\n  let annotation;\r\n\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let boundingRect = svg.getBoundingClientRect();\r\n\r\n  if (!color) {\r\n    if (type === 'highlight') {\r\n      color = 'FFFF00';\r\n    } else if (type === 'strikeout') {\r\n      color = 'FF0000';\r\n    }\r\n  }\r\n\r\n  // Initialize the annotation\r\n  annotation = {\r\n    type,\r\n    color,\r\n    rectangles: [...rects].map((r) => {\r\n      let offset = 0;\r\n\r\n      if (type === 'strikeout') {\r\n        offset = r.height / 2;\r\n      }\r\n\r\n      return scaleDown(svg, {\r\n        y: (r.top + offset) - boundingRect.top,\r\n        x: r.left - boundingRect.left,\r\n        width: r.width,\r\n        height: r.height\r\n      });\r\n    }).filter((r) => r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1)\r\n  };\r\n  \r\n  // Short circuit if no rectangles exist\r\n  if (annotation.rectangles.length === 0) {\r\n    return;\r\n  }\r\n\r\n  // Special treatment for area as it only supports a single rect\r\n  if (type === 'area') {\r\n    let rect = annotation.rectangles[0];\r\n    delete annotation.rectangles;\r\n    annotation.x = rect.x;\r\n    annotation.y = rect.y;\r\n    annotation.width = rect.width;\r\n    annotation.height = rect.height;\r\n  }\r\n\r\n  let { documentId, pageNumber } = getMetadata(svg);\r\n\r\n  // Add the annotation\r\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n    .then((annotation) => {\r\n      appendChild(svg, annotation);\r\n    });\r\n}\r\n\r\n/**\r\n * Enable rect behavior\r\n */\r\nexport function enableRect(type) {\r\n  _type = type;\r\n  \r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n/**\r\n * Disable rect behavior\r\n */\r\nexport function disableRect() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport appendChild from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  scaleDown\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet input;\r\nlet _textSize;\r\nlet _textColor;\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return;\r\n  }\r\n\r\n  input = document.createElement('input');\r\n  input.setAttribute('id', 'pdf-annotate-text-input');\r\n  input.setAttribute('placeholder', 'Enter text');\r\n  input.style.border = `3px solid ${BORDER_COLOR}`;\r\n  input.style.borderRadius = '3px';\r\n  input.style.position = 'absolute';\r\n  input.style.top = `${e.clientY}px`;\r\n  input.style.left = `${e.clientX}px`;\r\n  input.style.fontSize = `${_textSize}px`;\r\n\r\n  input.addEventListener('blur', handleInputBlur);\r\n  input.addEventListener('keyup', handleInputKeyup);\r\n\r\n  document.body.appendChild(input);\r\n  input.focus();\r\n}\r\n\r\n/**\r\n * Handle input.blur event\r\n */\r\nfunction handleInputBlur() {\r\n  saveText();\r\n}\r\n\r\n/**\r\n * Handle input.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleInputKeyup(e) {\r\n  if (e.keyCode === 27) {\r\n    closeInput();\r\n  } else if (e.keyCode === 13) {\r\n    saveText();\r\n  }\r\n}\r\n\r\n/**\r\n * Save a text annotation from input\r\n */\r\nfunction saveText() {\r\n  if (input.value.trim().length > 0) {\r\n    let clientX = parseInt(input.style.left, 10);\r\n    let clientY = parseInt(input.style.top, 10);\r\n    let svg = findSVGAtPoint(clientX, clientY);\r\n    if (!svg) {\r\n      return;\r\n    }\r\n\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n    let rect = svg.getBoundingClientRect();\r\n    let annotation = Object.assign({\r\n      type: 'textbox',\r\n      size: _textSize,\r\n      color: _textColor,\r\n      content: input.value.trim()\r\n    }, scaleDown(svg, {\r\n      x: clientX - rect.left,\r\n      y: clientY - rect.top,\r\n      width: input.offsetWidth,\r\n      height: input.offsetHeight\r\n    })\r\n    );\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\r\n      .then((annotation) => {\r\n        appendChild(svg, annotation);\r\n      });\r\n  }\r\n\r\n  closeInput();\r\n}\r\n\r\n/**\r\n * Close the input\r\n */\r\nfunction closeInput() {\r\n  try {\r\n    if (input) {\r\n      input.removeEventListener('blur', handleInputBlur);\r\n      input.removeEventListener('keyup', handleInputKeyup);\r\n      document.body.removeChild(input);\r\n      input = null;\r\n    }\r\n  } catch(e){\r\n    console.log('Try/catch is necessary because exist a error in Safari');\r\n  }\r\n}\r\n\r\n/**\r\n * Set the text attributes\r\n *\r\n * @param {Number} textSize The size of the text\r\n * @param {String} textColor The color of the text\r\n */\r\nexport function setText(textSize = 12, textColor = '000000') {\r\n  _textSize = parseInt(textSize, 10);\r\n  _textColor = textColor;\r\n}\r\n\r\n\r\n/**\r\n * Enable text behavior\r\n */\r\nexport function enableText() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n\r\n/**\r\n * Disable text behavior\r\n */\r\nexport function disableText() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\r\n\r\n// Template for creating a new page\r\nconst PAGE_TEMPLATE = `\r\n  <div style=\"visibility: hidden;\" class=\"page\" data-loaded=\"false\">\r\n    <div class=\"canvasWrapper\">\r\n      <canvas></canvas>\r\n    </div>\r\n    <svg class=\"annotationLayer\"></svg>\r\n    <div class=\"textLayer\"></div>\r\n  </div>\r\n`;\r\n\r\n/**\r\n * Create a new page to be appended to the DOM.\r\n *\r\n * @param {Number} pageNumber The page number that is being created\r\n * @return {HTMLElement}\r\n */\r\nexport function createPage(pageNumber) {\r\n  let temp = document.createElement('div');\r\n  temp.innerHTML = PAGE_TEMPLATE;\r\n\r\n  let page = temp.children[0];\r\n  let canvas = page.querySelector('canvas');\r\n\r\n  page.setAttribute('id', `pageContainer${pageNumber}`);\r\n  page.setAttribute('data-page-number', pageNumber);\r\n\r\n  canvas.mozOpaque = true;\r\n  canvas.setAttribute('id', `page${pageNumber}`);\r\n\r\n  return page;\r\n}\r\n\r\n/**\r\n * Render a page that has already been created.\r\n *\r\n * @param {Number} pageNumber The page number to be rendered\r\n * @param {Object} renderOptions The options for rendering\r\n * @return {Promise} Settled once rendering has completed\r\n *  A settled Promise will be either:\r\n *    - fulfilled: [pdfPage, annotations]\r\n *    - rejected: Error\r\n */\r\nexport function renderPage(pageNumber, renderOptions) {\r\n  let {\r\n    documentId,\r\n    pdfDocument,\r\n    scale,\r\n    rotate\r\n  } = renderOptions;\r\n\r\n  // Load the page and annotations\r\n  return Promise.all([\r\n    pdfDocument.getPage(pageNumber),\r\n    PDFJSAnnotate.getAnnotations(documentId, pageNumber)\r\n  ]).then(([pdfPage, annotations]) => {\r\n    let page = document.getElementById(`pageContainer${pageNumber}`);\r\n    let svg = page.querySelector('.annotationLayer');\r\n    let canvas = page.querySelector('.canvasWrapper canvas');\r\n    let canvasContext = canvas.getContext('2d', {alpha: false});\r\n    let viewport = pdfPage.getViewport(scale, rotate);\r\n    let transform = scalePage(pageNumber, viewport, canvasContext);\r\n\r\n    // Render the page\r\n    return Promise.all([\r\n      pdfPage.render({ canvasContext, viewport, transform }),\r\n      PDFJSAnnotate.render(svg, viewport, annotations)\r\n    ]).then(() => {\r\n      // Text content is needed for a11y, but is also necessary for creating\r\n      // highlight and strikeout annotations which require selecting text.\r\n      return pdfPage.getTextContent({normalizeWhitespace: true}).then((textContent) => {\r\n        return new Promise((resolve, reject) => {\r\n          // Render text layer for a11y of text content\r\n          let textLayer = page.querySelector(`.textLayer`);\r\n          let textLayerFactory = new PDFJS.DefaultTextLayerFactory();\r\n          let textLayerBuilder = textLayerFactory.createTextLayerBuilder(textLayer, pageNumber -1, viewport);\r\n          textLayerBuilder.setTextContent(textContent);\r\n          textLayerBuilder.render();\r\n\r\n          // Enable a11y for annotations\r\n          // Timeout is needed to wait for `textLayerBuilder.render`\r\n          setTimeout(() => {\r\n            try {\r\n              renderScreenReaderHints(annotations.annotations);\r\n              resolve();\r\n            } catch (e) {\r\n              reject(e);\r\n            }\r\n          });\r\n        });\r\n      });\r\n    }).then(() => {\r\n      // Indicate that the page was loaded\r\n      page.setAttribute('data-loaded', 'true');\r\n\r\n      return [pdfPage, annotations];\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Scale the elements of a page.\r\n *\r\n * @param {Number} pageNumber The page number to be scaled\r\n * @param {Object} viewport The viewport of the PDF page (see pdfPage.getViewport(scale, rotate))\r\n * @param {Object} context The canvas context that the PDF page is rendered to\r\n * @return {Array} The transform data for rendering the PDF page\r\n */\r\nfunction scalePage(pageNumber, viewport, context) {\r\n  let page = document.getElementById(`pageContainer${pageNumber}`);\r\n  let canvas = page.querySelector('.canvasWrapper canvas');\r\n  let svg = page.querySelector('.annotationLayer');\r\n  let wrapper = page.querySelector('.canvasWrapper');\r\n  let textLayer = page.querySelector('.textLayer');\r\n  let outputScale = getOutputScale(context);\r\n  let transform = !outputScale.scaled ? null : [outputScale.sx, 0, 0, outputScale.sy, 0, 0];\r\n  let sfx = approximateFraction(outputScale.sx);\r\n  let sfy = approximateFraction(outputScale.sy);\r\n\r\n  // Adjust width/height for scale\r\n  page.style.visibility = '';\r\n  canvas.width = roundToDivide(viewport.width * outputScale.sx, sfx[0]);\r\n  canvas.height = roundToDivide(viewport.height * outputScale.sy, sfy[0]);\r\n  canvas.style.width = roundToDivide(viewport.width, sfx[1]) + 'px';\r\n  canvas.style.height = roundToDivide(viewport.height, sfx[1]) + 'px';\r\n  svg.setAttribute('width', viewport.width);\r\n  svg.setAttribute('height', viewport.height);\r\n  svg.style.width = `${viewport.width}px`;\r\n  svg.style.height = `${viewport.height}px`;\r\n  page.style.width = `${viewport.width}px`;\r\n  page.style.height = `${viewport.height}px`;\r\n  wrapper.style.width = `${viewport.width}px`;\r\n  wrapper.style.height = `${viewport.height}px`;\r\n  textLayer.style.width = `${viewport.width}px`;\r\n  textLayer.style.height = `${viewport.height}px`;\r\n\r\n  return transform;\r\n}\r\n\r\n/**\r\n * The following methods are taken from mozilla/pdf.js and as such fall under\r\n * the Apache License (http://www.apache.org/licenses/).\r\n *\r\n * Original source can be found at mozilla/pdf.js:\r\n * https://github.com/mozilla/pdf.js/blob/master/web/ui_utils.js\r\n */\r\n\r\n/**\r\n * Approximates a float number as a fraction using Farey sequence (max order\r\n * of 8).\r\n *\r\n * @param {Number} x Positive float number\r\n * @return {Array} Estimated fraction: the first array item is a numerator,\r\n *                 the second one is a denominator.\r\n */\r\nfunction approximateFraction(x) {\r\n  // Fast path for int numbers or their inversions.\r\n  if (Math.floor(x) === x) {\r\n    return [x, 1];\r\n  }\r\n\r\n  const xinv = 1 / x;\r\n  const limit = 8;\r\n  if (xinv > limit) {\r\n    return [1, limit];\r\n  } else if (Math.floor(xinv) === xinv) {\r\n    return [1, xinv];\r\n  }\r\n\r\n  const x_ = x > 1 ? xinv : x;\r\n  \r\n  // a/b and c/d are neighbours in Farey sequence.\r\n  let a = 0, b = 1, c = 1, d = 1;\r\n  \r\n  // Limit search to order 8.\r\n  while (true) {\r\n    // Generating next term in sequence (order of q).\r\n    let p = a + c, q = b + d;\r\n    if (q > limit) {\r\n      break;\r\n    }\r\n    if (x_ <= p / q) {\r\n      c = p; d = q;\r\n    } else {\r\n      a = p; b = q;\r\n    }\r\n  }\r\n\r\n  // Select closest of neighbours to x.\r\n  if (x_ - a / b < c / d - x_) {\r\n    return x_ === x ? [a, b] : [b, a];\r\n  } else {\r\n    return x_ === x ? [c, d] : [d, c];\r\n  }\r\n}\r\n\r\nfunction getOutputScale(ctx) {\r\n  let devicePixelRatio = window.devicePixelRatio || 1;\r\n  let backingStoreRatio = ctx.webkitBackingStorePixelRatio ||\r\n                          ctx.mozBackingStorePixelRatio ||\r\n                          ctx.msBackingStorePixelRatio ||\r\n                          ctx.oBackingStorePixelRatio ||\r\n                          ctx.backingStorePixelRatio || 1;\r\n  let pixelRatio = devicePixelRatio / backingStoreRatio;\r\n  return {\r\n    sx: pixelRatio,\r\n    sy: pixelRatio,\r\n    scaled: pixelRatio !== 1\r\n  };\r\n}\r\n\r\nfunction roundToDivide(x, div) {\r\n  let r = x % div;\r\n  return r === 0 ? x : Math.round(x - r + div);\r\n}\r\n"],"sourceRoot":""}